---
group: Prototypes
title: Long List (checkboxes)
layout: long-list-checkboxes/views/_main
---

{% set prevPage = "hub" %}

{% block preMain %}

{{
    onsBreadcrumbs({
        "ariaLabel": 'Back',
        "itemsList": [
            {
                "url": "#",
                "id": "backlink",
                "text": 'Back',
                "attributes": {
                    "data-attribute": "Example attribute",
                    "onclick": "previousQuestion(); this.blur();"
                }
            }
        ]
    })
}}

{% endblock %}

{% block main %}

<h1 class="ons-u-fs-xl">
    What was your expenditure on <strong id="listItemHighlighted" class="ons-highlight"></strong>?
</h1>

{% from "components/input/_macro.njk" import onsInput %}
{{
    onsInput({
        "id": "expenditure",
        "type": "number",
        "width": "8",
        "autocomplete": "off",
        "label": {
            "text": "To the nearest thousand pounds"
        },
        "prefix": {
            "title": "British pounds (GBP)",
            "text": "Â£",
            "id": "annual-salary-gpb-prefix"
        }
    })
}}



{{
    onsButton({
        "text": 'Save and continue',
        "classes": 'ons-u-mb-l ons-u-mt-l',
        "attributes": {
                        "onclick": "nextQuestion(); this.blur();"
                    }
    })
}}

<p id="progressIndicator"></p>

{% endblock %}

{% block bodyEnd %}

<script>
    const previousURL = document.referrer;
        var currentIndex = 0;
        // Step 1: Retrieve the stored string from localStorage
        const storedValue = localStorage.getItem('ddvalue');

        // Step 2: Parse the string into a JavaScript object
        const parsedValue = JSON.parse(storedValue);

        // Step 3: Access the first value from the nested arrays
        const firstItem = parsedValue[0][0].includes('&#44;') ? parsedValue[0][0].replace(/&#44;/g, ',') : parsedValue[0][0];

        //Step 4: Find out the number of items
        const numberOfItems = parsedValue.length;
        const numberOfItemsStr = numberOfItems.toString();

        // Check if the referring URL includes "hub-complete"
        if (previousURL.includes("hub-complete")) {
            currentIndex = numberOfItems - 1;

            // Set the value of the input with id "expenditure"
            const lastExpenditureValue = parsedValue[currentIndex][1];
            if (lastExpenditureValue !== undefined) {
                document.getElementById('expenditure').value = lastExpenditureValue;
                document.getElementById('listItemHighlighted').textContent = parsedValue[currentIndex][0];
            }
        }
        else{
            // Update the question to include the list item
            document.getElementById('listItemHighlighted').textContent = firstItem;
        }
        
        // Update the progress indicator
        if(currentIndex != 0 ){
            var completedIndex = currentIndex + 1;
            document.getElementById('progressIndicator').textContent = completedIndex + ' of ' + numberOfItemsStr + ' goods and services completed';
        }

    

function nextQuestion() {
    if (currentIndex < numberOfItems - 1) {
        // Get the current item and its value
        const currentItem = parsedValue[currentIndex][0];

        // Get the updated value from the "expenditure" input
        const expenditureValue = document.getElementById('expenditure').value;

        // Update parsedValue to include the expenditure value
        parsedValue[currentIndex][1] = expenditureValue;

        // Update localStorage to store the updated parsedValue
        localStorage.setItem("ddvalue", JSON.stringify(parsedValue));

        currentIndex++;

        // Update the displayed item and progress indicator
        const nextItem = parsedValue[currentIndex][0].includes('&#44;')
            ? parsedValue[currentIndex][0].replace(/&#44;/g, ',')
            : parsedValue[currentIndex][0];

        if(parsedValue[currentIndex][1]){
            document.getElementById('expenditure').value = parsedValue[currentIndex][1];
        }
        else{
            document.getElementById('expenditure').value = '';
        }

        document.getElementById('listItemHighlighted').textContent = nextItem;
        document.getElementById('progressIndicator').textContent =
            currentIndex + ' of ' + numberOfItemsStr + ' goods and services completed';
    } else {
        // Handle end of questions or loop back to the first question
        console.log('End of questions');
        
        // Get the current item and its value
        const currentItem = parsedValue[currentIndex][0];

        // Get the updated value from the "expenditure" input
        const expenditureValue = document.getElementById('expenditure').value;

        // Update parsedValue to include the expenditure value
        parsedValue[currentIndex][1] = expenditureValue;

        // Update localStorage to store the updated parsedValue
        localStorage.setItem("ddvalue", JSON.stringify(parsedValue));
        window.location.href = '/prototypes/long-list-checkboxes/hub-complete.html';
    }
}




function previousQuestion() {
    if (currentIndex > 0) {
        currentIndex--;

        // Get the current item and its value
        const currentItem = parsedValue[currentIndex][0];
        const previousItem = currentItem.includes('&#44;') ? currentItem.replace(/&#44;/g, ',') : currentItem;

        // Update the displayed item
        document.getElementById('listItemHighlighted').textContent = previousItem;

        // Check if there is a value in parsedValue[currentIndex][1]
        const storedExpenditureValue = parsedValue[currentIndex][1];
        if (storedExpenditureValue !== undefined) {
            // Set the value of the input with id "expenditure"
            document.getElementById('expenditure').value = storedExpenditureValue;
        } else {
            document.getElementById('expenditure').value = '';
        }

        // Update the progress indicator
        if (currentIndex !== 0) {
            document.getElementById('progressIndicator').textContent = currentIndex + ' of ' + numberOfItemsStr + ' goods and services completed';
        } else {
            document.getElementById('progressIndicator').textContent = '';
        }
    } else {
        // Optionally handle going to the last question or display a message
        console.log('Go back to Hub');
        window.location.href = '/prototypes/long-list-checkboxes/hub.html';
    }
}


    

</script>

{% endblock %}
